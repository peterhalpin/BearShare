---
title: "Minimal example for cirt package."
author: "Peter F Halpin"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

This code illustrates how to use the functions in the `R` package `cirt`. For additional details, check out the package documentation and see Halpin P. F. and Bergner, Y. (2017) *Psychometric models for small group collaborations.* Please contact me at `peter.halpin@nyu.edu` with questions or feedback. 

Set up sesssion.

```{r echo = T, message = F, warning = F}
# devtools::install_github("peterhalpin/cirt")
library(cirt)
require(Matrix)
require(dplyr)
```

Data generating parameters for individual and group tests.

```{r 1 }
n_obs <- 50 # n respondents
K <- n_obs/2 # n groups
n_items <- 100 # n items on each assessment
e <- .05 # beta prior parm
set.seed(101)
```

Item parms for individual test.
```{r 2}
ind_alpha <- runif(n_items, .65, 2.5)
ind_beta <- sort(rnorm(n_items, mean = 0, sd = 1.3))
ind_parms <- data.frame(ind_alpha, ind_beta)
ind_names <- paste0("item", 1:n_items, "_IND")
row.names(ind_parms) <- ind_names
names(ind_parms) <- c("alpha", "beta")
```

Item parms for group test.
```{r 3}
col_alpha <- runif(n_items, .65, 2.5)
col_beta <- sort(rnorm(n_items, mean = 0, sd = 1.3))
col_parms <- data.frame(col_alpha, col_beta)
col_names <- paste0("item", 1:n_items, "_COL")
row.names(col_parms) <- col_names
names(col_parms) <- c("alpha", "beta")
parms <- rbind(col_parms, ind_parms)
```

Ability levels of respondents.
```{r 4}
odd <- seq(1, n_obs, by = 2)
theta <- rnorm(n_obs)
theta1 <- theta[odd] # odds
theta2 <- theta[odd + 1] # evens1
```

The RSC weight parameter.
```{r 5}
w <- rbeta(K, 1 + e, 1 + e)
```

Generate data on both test forms. Note that `ind_data` is using `w = 1/2` with the each respondent's ability level repeated for `theta1` and `theta2`, which gives the individual performance of each respondent. 
```{r 6}
col_data <- data_gen(1, w, col_parms, theta1, theta2)
ind_data <- data_gen(1, rep(.5, n_obs), ind_parms, theta, theta)
data <- cbind(col_data[rep(1:K, each = 2),], ind_data[, -c(1:5)])
```

Take a look at the formatting. Data-generating information is repeated on each line, but odd rows of the individual assessment are for `theta`1 and even rows are for ` theta2`. 

```{r 7}
head(data[ ,c(1:10, 110:115)])
```

Estimate individual ability and the RSC model simultaneously, using either ML or MAP. Use parallel for faster performance with larger datasets, see `help(est_RSC)` for details. 

```{r 8}
ml <- est_RSC(data, parms, method = "ML", parallel = F)
map <- est_RSC(data, parms, method = "MAP", parallel = F)
```

```{r 9}
plot(w, ml$w)
points(w, map$w, col = 5)
abline(a = 0, b = 1)
```

That's all for now. Check back soon for real data examples. 

